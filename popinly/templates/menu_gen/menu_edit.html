{% extends "base_generic.html" %}
{% load crispy_forms_tags %}

{% block content %}
  <div class="alert alert-warning alert-dismissible fade show" role="alert">
    To add and remove items check the items delete box and submit your changes at the bottom of the page.
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <h1>Editing Menu</h1>

  <form method="POST">
    {% for hidden_field in form.hidden_fields %}
      {{ hidden_field.errors }}
      {{ hidden_field }}
    {% endfor %}
    {% csrf_token %}
    {{ form.management_form }}
    {{ form.non_form_errors }}
    {% for menu_section_form in form.forms %}
      <hr>
      <span class="d-block p-2 bg-primary text-white">
        {% if menu_section_form.instance.name %}
          <h2>Editing Menu Section: {{ menu_section_form.instance.name }}</h2>
        {% else %}
          {% if form.forms|length > 1 %}
            <h2>Add another Menu Section</h2>
          {% else %}
            <h2>Add a Menu Section</h2>
          {% endif %}
        {% endif %}
      {% for hidden_field in menu_section_form.hidden_fields %}
        {{ hidden_field.errors }}
        {{ hidden_field }}
      {% endfor %}
      <div class="form-row">
        <div class="form-group col-md-11 mb-0">
          {{ menu_section_form.name|as_crispy_field }}
        </div>
        <div class="form-group col mb-0">
          {{ menu_section_form.order|as_crispy_field }}
        </div>
      </div>
      {{ menu_section_form.description|as_crispy_field }}
      <div class="form-group mb-2">
        <button type="submit" class="btn btn-success">Save</button>
        <span> Delete {{ menu_section_form.DELETE }} </span>
      </div>
      {% if menu_section_form.nested %}
        <h3>Items</h3>
          {{ menu_section_form.nested.management_form }}
          {{ menu_section_form.nested.non_form_errors }}
          {% for menu_item_form in menu_section_form.nested.forms %}
            <span class="d-block p-2 bg-secondary text-white">
              {% if menu_item_form.instance.name %}
                <h5>Editing Menu Item: {{ menu_item_form.instance.name }}</h5>
              {% else %}
                <h5>Add a Menu Item</h5>
              {% endif %}
              {% for hidden_field in menu_item_form.hidden_fields %}
                {{ hidden_field.errors }}
                {{ hidden_field }}
              {% endfor %}
                <div class="form-group">
                  <div class="form-row">
                    <div class="col-10 mb-0">
                      {{ menu_item_form.name|as_crispy_field }}
                    </div>
                    <div class="col mb-0">
                      {{ menu_item_form.price|as_crispy_field }}
                    </div>                
                    <div class="col mb-0">
                      {{ menu_item_form.order|as_crispy_field }}
                    </div>
                  </div>
                  {{ menu_item_form.description|as_crispy_field }}
                  <div class="form-group mb-2">
                    <button type="submit" class="btn btn-success">Save</button>
                    <span> Delete {{ menu_item_form.DELETE }} </span>
                  </div>
                </div>
              </span>
            <br>
            {% endfor %}
      {% endif %}
    {% endfor %}
<br>
  <p>
    <button type="submit" class="btn btn-success">Update Menu</button>
    <a class="btn btn-outline" href="{% url 'menu_gen:index' %}">Cancel</a>
  </p>
</form>
{% endblock %}